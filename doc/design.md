# 1 概述

fishgo设计原则与历史

# 2 目标

简要的公共库

# 3 原则

* 模块化，每个模块只做一个事情，能随意组合模块实现需要的结果
* 无侵入性，避免一个模块的使用需要侵入性引入其他框架和模块，每个模块都应该是能独立使用的
* 无偏好性，例如，有些人喜欢exception，有些人喜欢error，接口中已经支持这两种做法，而不是只偏向一种。
* 灵活，提供简单而且扩展性大的接口，恰当地引入中间件机制，装饰器机制，依赖注入等等
* 一致，名称一致，start对应stop，connect对应disconnect，run对应close，不要乱配对
* 兼容，已经发布的接口不能改变语义，提供新语义要么新建模块，要么新建函数
* 稳定，必须有完整和强健的单元测试

# 4 约定

## 4.1 点号引入

一般模块都是点号引入的，注意模块的名字要用全名，不用New，而用NewXXXX

## 4.2 Daemon生命周期

Daemon的生命周期为run和close

run就是同步阻塞，开始运行，直到daemmon异常或正常退出。至于在调用run之前或之后，是否接受运行任务则未定义，各业务可以按照自己需要来做。

close就是中断关闭daemon，它会在完成所有的收尾工作后才返回。

这样做的原因是：

* 如果不提供run的同步阻塞接口，遇到单daemon运行的程序时，主程序就会因为没事而做而提前结束。例如，web的queue没有run接口，所以web无法执行单独运行queue的任务
* 不需要提供start与wait接口，因为run接口以go方式运行时就有start的功效，wait的功效可以通过等待run接口返回来实现。
* close需要完成所有的收尾工作后才返回，是为了保证close返回后就能执行重试了，避免边close边重试的冲突问题

## 4.3 error与exception

除了language包，其他模块的接口都不允许在实现里面直接panic，也就是接口必须能支持返回error来检查出错的。另外，对于那些经常需要检查error返回值的业务而言，可以提供额外的Must接口，以提高使用的体验。这样做可以同时兼顾返回error的灵活性，和使用exception的便利性。

# 5 历史

## 5.1 20180225

重新设计web的模块，将其重构到app的模块，目的是更加模块化的实现，当然，代价是写代码远远没有原来方便了，普通的web的项目依然建议用成熟的web模块。app模块暂时只作为实验性质，不要使用。

